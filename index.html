<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: "Poppins", sans-serif;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            height: 100vh;
            background-color: aliceblue;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calculator {
            background-color: #3a4452;
            padding: 2em;
            border-radius: 1em;
        }

        .calculator form input {
            border: 0;
            outline: 0;
            width: 60px;
            height: 50px;
            border-radius: 10px;
            box-shadow: -8px -8px 15px rgba(0, 0, 0, 0.1),
                -5px -5px 15px rgba(57, 57, 57, 0.2);
            background-color: transparent;
            font-size: 20px;
            color: white;
            cursor: pointer;
            margin: 10px;
            border: solid 1px #000000;
        }

        form .display {
            display: flex;
            justify-content: flex-end;
            margin: 20px 0;
        }

        #display {
            border: none;
            background-color: #828fa2;
            border-radius: 10px;
            border: solid 3px black;
            color: #000000;
            padding: 10px;
        }

        form .display input {
            text-align: right;
            flex-grow: 1;
            font-size: 45px;
            box-shadow: none;
        }

        form input.equal {
            width: 142px;
        }

        .calculator form .function-buttons input {
            background-color: #2a3340;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="calculator">
            <form>
                <div class="display">
                    <input type="text" name="display" id="display" readonly>
                </div>
                <div class="function-buttons">
                    <input type="button" value="√" onclick="appendToDisplay('√(')">
                    <input type="button" value="(" onclick="appendToDisplay('(')">
                    <input type="button" value=")" onclick="appendToDisplay(')')">
                    <input type="button" value="^" onclick="appendToDisplay('^')">
                </div>
                <div class="function-buttons">
                    <input type="button" value="sin" onclick="appendToDisplay('sin(')">
                    <input type="button" value="cos" onclick="appendToDisplay('cos(')">
                    <input type="button" value="tan" onclick="appendToDisplay('tan(')">
                    <input type="button" value="π" onclick="appendToDisplay('π')">
                </div>
                <div class="function-buttons">
                    <input type="button" value="ln" onclick="appendToDisplay('ln(')">
                    <input type="button" value="log" onclick="appendToDisplay('log(')">
                    <input type="button" value="e" onclick="appendToDisplay('e')">
                    <input type="button" value="×10^" onclick="appendToDisplay('×10^')">
                </div>
                <div>
                    <input type="button" value="AC" onclick="clearDisplay()">
                    <input type="button" value="DE" onclick="deleteLastChar()">
                    <input type="button" value="." onclick="appendToDisplay('.')">
                    <input type="button" value="÷" onclick="appendToDisplay('/')">
                </div>
                <div>
                    <input type="button" value="7" onclick="appendToDisplay('7')">
                    <input type="button" value="8" onclick="appendToDisplay('8')">
                    <input type="button" value="9" onclick="appendToDisplay('9')">
                    <input type="button" value="×" onclick="appendToDisplay('*')">
                </div>
                <div>
                    <input type="button" value="4" onclick="appendToDisplay('4')">
                    <input type="button" value="5" onclick="appendToDisplay('5')">
                    <input type="button" value="6" onclick="appendToDisplay('6')">
                    <input type="button" value="-" onclick="appendToDisplay('-')">
                </div>
                <div>
                    <input type="button" value="1" onclick="appendToDisplay('1')">
                    <input type="button" value="2" onclick="appendToDisplay('2')">
                    <input type="button" value="3" onclick="appendToDisplay('3')">
                    <input type="button" value="+" onclick="appendToDisplay('+')">
                </div>
                <div>
                    <input type="button" value="00" onclick="appendToDisplay('00')">
                    <input type="button" value="0" onclick="appendToDisplay('0')">
                    <input type="button" value="=" onclick="calculate()" class="equal">
                </div>
            </form>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');

        function appendToDisplay(value) {
            display.value += value;
        }

        function clearDisplay() {
            display.value = '';
        }

        function deleteLastChar() {
            display.value = display.value.slice(0, -1);
        }

        function tokenize(expr) {
                // First, add explicit multiplication symbols where needed
                expr = expr
                    // Between number and letter (for constants and functions)
                    .replace(/(\d)([a-zA-Z])/g, '$1*$2')
                    // Between number and opening parenthesis
                    .replace(/(\d)(\()/g, '$1*$2')
                    // Between closing parenthesis and number
                    .replace(/(\))(\d)/g, '$1*$2')
                    // Between closing parenthesis and opening parenthesis
                    .replace(/(\))(\()/g, '$1*$2')
                    // Between closing parenthesis and letter
                    .replace(/(\))([a-zA-Z])/g, '$1*$2')
                    // Between number and constants
                    .replace(/(\d)(π|e)/g, '$1*$2')
                    // Between constants and number
                    .replace(/(π|e)(\d)/g, '$1*$2')
                    // Between constants and opening parenthesis
                    .replace(/(π|e)(\()/g, '$1*$2');

                const tokens = [];
                let numBuffer = '';
                const regex = /(\d*\.?\d+)|(sin|cos|tan|log|ln|\+|\-|\*|\/|\^|\(|\))/g;

                // Replace constants
                expr = expr.replace(/π/g, Math.PI.toString())
                    .replace(/e/g, Math.E.toString());

                let match;
                while ((match = regex.exec(expr)) !== null) {
                    if (match[1]) { // number
                        tokens.push(parseFloat(match[1]));
                    } else if (match[2]) { // operator or function
                        if (numBuffer) {
                            tokens.push(parseFloat(numBuffer));
                            numBuffer = '';
                        }
                        tokens.push(match[2]);
                    }
                }

                if (numBuffer) {
                    tokens.push(parseFloat(numBuffer));
                }

                return tokens;
            }

        function toPostfix(tokens) {
            const output = [];
            const stack = [];
            const precedence = {
                '^': 4,
                '*': 3,
                '/': 3,
                '+': 2,
                '-': 2,
                'sin': 5,
                'cos': 5,
                'tan': 5,
                'log': 5,
                'ln': 5,
                '√': 5
            };

            tokens.forEach(token => {
                if (typeof token === 'number') {
                    output.push(token);
                } else if (['sin', 'cos', 'tan', 'log', 'ln', '√'].includes(token)) {
                    stack.push(token);
                } else if (token === '(') {
                    stack.push(token);
                } else if (token === ')') {
                    while (stack.length && stack[stack.length - 1] !== '(') {
                        output.push(stack.pop());
                    }
                    stack.pop(); // Remove '('
                    if (stack.length && ['sin', 'cos', 'tan', 'log', 'ln', '√'].includes(stack[stack.length - 1])) {
                        output.push(stack.pop());
                    }
                } else {
                    while (
                        stack.length &&
                        stack[stack.length - 1] !== '(' &&
                        precedence[stack[stack.length - 1]] >= precedence[token]
                    ) {
                        output.push(stack.pop());
                    }
                    stack.push(token);
                }
            });

            while (stack.length) {
                output.push(stack.pop());
            }

            return output;
        }

        function evaluatePostfix(postfix) {
            const stack = [];
            const toRadians = x => x * Math.PI / 180;

            postfix.forEach(token => {
                if (typeof token === 'number') {
                    stack.push(token);
                } else if (['sin', 'cos', 'tan', 'log', 'ln', '√'].includes(token)) {
                    const a = stack.pop();
                    switch (token) {
                        case 'sin':
                            stack.push(Math.sin(toRadians(a)));
                            break;
                        case 'cos':
                            stack.push(Math.cos(toRadians(a)));
                            break;
                        case 'tan':
                            stack.push(Math.tan(toRadians(a)));
                            break;
                        case 'log':
                            if (a <= 0) throw new Error('Invalid logarithm');
                            stack.push(Math.log10(a));
                            break;
                        case 'ln':
                            if (a <= 0) throw new Error('Invalid logarithm');
                            stack.push(Math.log(a));
                            break;
                        case '√':
                            if (a < 0) throw new Error('Invalid square root');
                            stack.push(Math.sqrt(a));
                            break;
                        default:
                            break;
                    }
                } else {
                    const b = stack.pop();
                    const a = stack.pop();

                    switch (token) {
                        case '+':
                            stack.push(a + b);
                            break;
                        case '-':
                            stack.push(a - b);
                            break;
                        case '*':
                            stack.push(a * b);
                            break;
                        case '/':
                            if (b === 0) throw new Error('Division by zero');
                            stack.push(a / b);
                            break;
                        case '^':
                            stack.push(Math.pow(a, b));
                            break;
                        default:
                            throw new Error('Invalid operator');
                    }
                }
            });

            return stack[0];
        }

        function calculate() {
            try {
                const expr = display.value
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/');
                const tokens = tokenize(expr);
                const postfix = toPostfix(tokens);
                const result = evaluatePostfix(postfix);
                display.value = result;
            } catch (error) {
                display.value = 'Error';
                console.error(error);
            }
        }

        // Add keyboard support
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                calculate();
            } else if (event.key === 'Backspace') {
                deleteLastChar();
            } else if (/[\d+\-*/.()]/.test(event.key)) {
                appendToDisplay(event.key);
            }
        });
    </script>
</body>

</html>